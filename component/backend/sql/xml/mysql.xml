<!--
  ~ @package   AkeebaSubs
  ~ @copyright Copyright (c)2010-2019 Nicholas K. Dionysopoulos / Akeeba Ltd
  ~ @license   GNU General Public License version 3, or later
  -->

<schema>
    <!-- Metadata -->
    <meta>
        <!-- Supported driver types -->
        <drivers>
            <driver>mysql</driver>
            <driver>mysqli</driver>
            <driver>pdomysql</driver>
        </drivers>
    </meta>

    <!-- SQL commands to run on installation and update -->
    <sql>

        <!-- Create missing tables from scratch -->
        <action table="#__akeebasubs_blockrules" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_blockrules` (
  `akeebasubs_blockrule_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(255) NOT NULL DEFAULT '',
  `name` varchar(255) NOT NULL DEFAULT '',
  `email` varchar(255) NOT NULL DEFAULT '',
  `iprange` varchar(255) NOT NULL DEFAULT '',

  `enabled` tinyint(4) NOT NULL DEFAULT '1',
  `created_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `created_by` bigint(20) NOT NULL DEFAULT '0',
  `modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `modifed_by` bigint(20) NOT NULL DEFAULT '0',
  `locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `locked_by` bigint(20) NOT NULL DEFAULT '0',
  PRIMARY KEY (`akeebasubs_blockrule_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_coupons" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_coupons` (
    `akeebasubs_coupon_id` bigint(20) unsigned NOT NULL auto_increment,
    `title` varchar(255) NOT NULL,
	`coupon` varchar(255) NOT NULL,
	`publish_up` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`publish_down` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`subscriptions` VARCHAR(255) NULL,
	`user` int(10) DEFAULT NULL,
    `email` VARCHAR( 255 ) NULL,
	`params` TEXT,
	`hitslimit` BIGINT(20) unsigned NULL,
	`userhits` BIGINT(20) unsigned NULL,
	`usergroups` VARCHAR(255) NULL,
	`type` ENUM('value','percent','lastpercent') NOT NULL DEFAULT 'value',
	`value` FLOAT NOT NULL DEFAULT 0.0,

	`enabled` tinyint(1) NOT NULL DEFAULT '1',
	`ordering` bigint(20) unsigned NOT NULL,
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`created_by` int(11) NOT NULL DEFAULT 0,
	`modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`modified_by` int(11) NOT NULL DEFAULT 0,
	`locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`locked_by` int(11) NOT NULL DEFAULT 0,
	`hits` BIGINT(20) unsigned NOT NULL default 0,
	PRIMARY KEY ( `akeebasubs_coupon_id` ),
	UNIQUE KEY `coupon` (`coupon`(100))
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_creditnotes" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_creditnotes` (
	`akeebasubs_invoice_id` BIGINT(20) UNSIGNED NOT NULL,
	`creditnote_no` BIGINT(20) unsigned NOT NULL,
	`display_number` VARCHAR(255) NULL,
	`creditnote_date` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`html` LONGTEXT,
	`atxt` LONGTEXT,
	`btxt` LONGTEXT,
	`filename` VARCHAR(255) NULL,
	`sent_on` DATETIME NULL,

	`enabled` tinyint(1) NOT NULL DEFAULT '1',
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`created_by` int(11) NOT NULL DEFAULT 0,
	`modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`modified_by` int(11) NOT NULL DEFAULT 0,
	`locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`locked_by` int(11) NOT NULL DEFAULT 0,
	PRIMARY KEY (`akeebasubs_invoice_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_emailtemplates" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_emailtemplates` (
    `akeebasubs_emailtemplate_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
    `key` varchar(255) NOT NULL DEFAULT '',
    `subscription_level_id` bigint(20) DEFAULT '0',
    `subject` varchar(255) NOT NULL DEFAULT '',
    `body` text,
    `language` varchar(10) NOT NULL DEFAULT '*',
    `enabled` tinyint(4) NOT NULL DEFAULT '1',
    `ordering` bigint(20) NOT NULL DEFAULT '0',
    `created_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `created_by` bigint(20) NOT NULL DEFAULT '0',
    `modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `modified_by` bigint(20) NOT NULL DEFAULT '0',
    `locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `locked_by` bigint(20) NOT NULL DEFAULT '0',
    PRIMARY KEY (`akeebasubs_emailtemplate_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
            <query><![CDATA[
REPLACE INTO `#__akeebasubs_emailtemplates`
(`akeebasubs_emailtemplate_id`, `key`, `subscription_level_id`, `subject`, `body`, `language`, `enabled`, `ordering`, `created_on`, `created_by`, `modified_on`, `modified_by`, `locked_on`, `locked_by`)
VALUES
	(1, 'subscriptionemails_paid', 0, 'Your [LEVEL] subscription at [SITENAME] is now enabled', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>The payment for your [LEVEL] subscription on our site has just been cleared. Your subscription is now activated and will remain active until [PUBLISH_DOWN] GMT.</p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 1, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(2, 'subscriptionemails_new_active', 0, 'Your new [LEVEL] subscription at [SITENAME]', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your new <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription is now activated and will remain active until [PUBLISH_DOWN] GMT.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 2, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(3, 'subscriptionemails_new_renewal', 0, 'Your [LEVEL] subscription renewal at [SITENAME]', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription has been renewed. The renewed subscription will be activated on [PUBLISH_UP] GMT and remain active until [PUBLISH_DOWN] GMT.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 3, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(4, 'subscriptionemails_new_pending', 0, 'Your new [LEVEL] subscription at [SITENAME] is being processed', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>The payment for your new or renewed <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription is currently being processed. When the payment is cleared we will send you a new email. </span><span style=\"line-height: 1.3em;\">Please note that on some occasions it may take 2 to 7 business days for the payment to be cleared. This time period is outside of our control and is mainly due to restrictions imposed by your bank or the payment processor company.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 4, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(5, 'subscriptionemails_cancelled_new', 0, 'Your new [LEVEL] subscription at [SITENAME] could not be processed', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>The payment processor declined the payment for your new or renewed <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription</span><span style=\"line-height: 1.3em;\">. Please revisit our site and retry subscribing using the same username and email address. You may want to select a different means of payment, for example a different credit card. We apologise for the inconvenience</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you to tried to subscribe to <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 5, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(6, 'subscriptionemails_cancelled_existing', 0, 'Your [LEVEL] subscription at [SITENAME] was cancelled', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>The payment for your <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription was cancelled by our payment processor or refunded at your request</span><span style=\"line-height: 1.3em;\">.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">If you believe you are receiving this message in error and would like to remain subscribed to our site, please visit our site, log in with your username and password and retry subscribing. You may want to select a different means of payment, for example a different credit card. We apologise for the inconvenience</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you had a subscription at <em>[SITENAME]</em>. Do not reply to this email, it\'s sent from an unmonitored email address.</p>\r\n</div>', '*', 1, 6, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(7, 'subscriptionemails_expired', 0, 'Your [LEVEL] subscription at [SITENAME] has expired', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription on our site has expired</span><span style=\"line-height: 1.3em;\">. If you want to renew it </span><a href=\"[MYSUBSURL]\" style=\"line-height: 1.3em;\">please visit the subscriptions status page on our site</a> and click on the \"Renew\" button to the right of the expired subscription.</p>\r\n<p><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you had a subscription at <em>[SITENAME]</em>. Do not reply to this email, it\'s sent from an unmonitored email address.</p>\r\n</div>', '*', 1, 7, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(8, 'subscriptionemails_published', 0, 'Your renewed [LEVEL] subscription at [SITENAME] has been activated', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription renewal on our site has been activated</span><span style=\"line-height: 1.3em;\">. It will remain active until [PUBLISH_DOWN] GMT.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n<p>You can <a href=\"[MYSUBSURL]\">review the status of all your subscriptions</a> any time on our site.</p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription at <em>[SITENAME]</em>. Do not reply to this email, it\'s sent from an unmonitored email address.</p>\r\n</div>', '*', 1, 8, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(9, 'subscriptionemails_generic', 0, 'Your [LEVEL] subscription at [SITENAME] has been updated', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your <span style=\"line-height: 1.3em;\">[LEVEL] </span><span style=\"line-height: 1.3em;\">subscription on our site has been modified. Its new details are:</span></p>\r\n<table width=\"100%\" border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\r\n<tbody>\r\n<tr>\r\n<td width=\"25%\"><strong>Username</strong></td>\r\n<td>[USERNAME] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription type</strong></td>\r\n<td>[LEVEL] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription status</strong></td>\r\n<td>[ENABLED] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Payment status</strong></td>\r\n<td>[PAYSTATE] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid From</strong></td>\r\n<td>[PUBLISH_UP] GMT</td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid To</strong></td>\r\n<td>[PUBLISH_DOWN] GMT </td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\">You can </span><a href=\"[MYSUBSURL]\" style=\"line-height: 1.3em;\">review the status of all your subscriptions</a><span style=\"line-height: 1.3em;\"> any time on our site.</span></span></p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription at <em>[SITENAME]</em>. Do not reply to this email, it\'s sent from an unmonitored email address.</p>\r\n</div>', '*', 1, 9, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(10, 'asexpirationnotify_first', 0, 'Your [LEVEL] subscription on [SITENAME] will expire soon', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your [LEVEL] subscription with the following details is going to expire soon:</p>\r\n<table width=\"100%\" border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\r\n<tbody>\r\n<tr>\r\n<td width=\"25%\"><strong>Username</strong></td>\r\n<td>[USERNAME] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription type</strong></td>\r\n<td>[LEVEL] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription status</strong></td>\r\n<td>[ENABLED] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Payment status</strong></td>\r\n<td>[PAYSTATE] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid From</strong></td>\r\n<td>[PUBLISH_UP] GMT</td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid To</strong></td>\r\n<td>[PUBLISH_DOWN] GMT </td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\">You can login any time on our site to </span><a href=\"[MYSUBSURL]\" style=\"line-height: 1.3em;\">review the status of all your subscriptions</a><span style=\"line-height: 1.3em;\"> and renew your expiring one.</span></span></span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 10, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(11, 'asexpirationnotify_second', 0, 'Your [LEVEL] subscription on [SITENAME] is about to expire', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>Your [LEVEL] subscription with the following details is going to expire very soon:</p>\r\n<table width=\"100%\" border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\r\n<tbody>\r\n<tr>\r\n<td width=\"25%\"><strong>Username</strong></td>\r\n<td>[USERNAME] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription type</strong></td>\r\n<td>[LEVEL] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription status</strong></td>\r\n<td>[ENABLED] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Payment status</strong></td>\r\n<td>[PAYSTATE] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid From</strong></td>\r\n<td>[PUBLISH_UP] GMT</td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid To</strong></td>\r\n<td>[PUBLISH_DOWN] GMT </td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\"><span style=\"line-height: 1.3em;\">You can login any time on our site to </span><a href=\"[MYSUBSURL]\" style=\"line-height: 1.3em;\">review the status of all your subscriptions</a><span style=\"line-height: 1.3em;\"> and renew your expiring one.</span></span></span></p>\r\n<p> </p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 11, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0),
	(12, 'asexpirationnotify_after', 0, 'Your expired subscription on [SITENAME]', '<div style=\"background-color: #e0e0e0; padding: 10px 20px;\">\r\n<div style=\"background-color: #f9f9f9; border-radius: 10px; padding: 5px 10px;\">\r\n<p>Hello [FIRSTNAME],</p>\r\n<p>We are contacting you to remind you that your subscription on [SITENAME] with the following details has already expired:</p>\r\n<table width=\"100%\" border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\r\n<tbody>\r\n<tr>\r\n<td width=\"25%\"><strong>Username</strong></td>\r\n<td>[USERNAME] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription type</strong></td>\r\n<td>[LEVEL] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Subscription status</strong></td>\r\n<td>[ENABLED] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Payment status</strong></td>\r\n<td>[PAYSTATE] </td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid From</strong></td>\r\n<td>[PUBLISH_UP] GMT</td>\r\n</tr>\r\n<tr>\r\n<td><strong>Valid To</strong></td>\r\n<td>[PUBLISH_DOWN] GMT </td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span><span><span>You can login any time on our site and renew your expired subscription. Renewing your subscription is very easy! You just have to go to the</span></span></span><span style=\"line-height: 1.3em;\"> </span><a href=\"[MYSUBSURL]\" style=\"line-height: 1.3em;\">subscriptions overview</a><span style=\"line-height: 1.3em;\"> page</span><span style=\"line-height: 1.3em;\"> and click on the Renew link.</span></p>\r\n<p><span style=\"line-height: 1.3em;\">We\'d like to remind you that you have registered on our site using the username [USERNAME] and email address [USEREMAIL].</span></p>\r\n</div>\r\n<p style=\"font-size: x-small; color: #667;\">You are receiving this automatic email message because you have a subscription in <em>[SITENAME]</em>. <span style=\"line-height: 1.3em;\">Do not reply to this email, it\'s sent from an unmonitored email address.</span></p>\r\n</div>', '*', 1, 12, '2013-01-23 00:00:00', 42, '0000-00-00 00:00:00', 0, '0000-00-00 00:00:00', 0)
;
            ]]></query>
        </action>

        <action table="#__akeebasubs_invoices" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_invoices` (
	`akeebasubs_subscription_id` BIGINT(20) UNSIGNED NOT NULL,
	`extension` VARCHAR(50) NOT NULL DEFAULT "misc",
	`invoice_no` BIGINT(20) unsigned NOT NULL,
	`display_number` VARCHAR(255) NULL,
	`invoice_date` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`html` LONGTEXT,
	`atxt` LONGTEXT,
	`btxt` LONGTEXT,
	`filename` VARCHAR(255) NULL,
	`sent_on` DATETIME NULL,

	`enabled` tinyint(1) NOT NULL DEFAULT '1',
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`created_by` int(11) NOT NULL DEFAULT 0,
	`modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`modified_by` int(11) NOT NULL DEFAULT 0,
	`locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`locked_by` int(11) NOT NULL DEFAULT 0,
	PRIMARY KEY (`akeebasubs_subscription_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_levels" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_levels` (
	`akeebasubs_level_id` bigint(20) unsigned NOT NULL auto_increment,
	`title` varchar(255) NOT NULL,
	`slug` varchar(255) NOT NULL,
	`image` varchar(1024) NOT NULL,
	`description` text,
	`duration` INT(10) UNSIGNED NOT NULL DEFAULT 365,
	`price` FLOAT NOT NULL DEFAULT '0',
    `paddle_product_id` varchar(100) NULL,
	`paddle_secret` varchar(100) NULL,
	`upsell` ENUM('never', 'always', 'renewal') DEFAULT 'never',
	`paddle_plan_id` varchar(100) NULL,
	`paddle_plan_secret` varchar(100) NULL,
	`ordertext` text,
    `orderurl` VARCHAR( 255 ) NULL,
	`canceltext` text,
    `cancelurl` VARCHAR( 255 ) NULL,
	`only_once` TINYINT(3) NOT NULL DEFAULT 0,
	`recurring` TINYINT(3) NOT NULL DEFAULT 0,
	`forever` TINYINT(3) NOT NULL DEFAULT 0,
	`access` int(11) NOT NULL DEFAULT '1',
	`fixed_date` DATETIME NULL,
	`renew_url` VARCHAR(2048) NULL DEFAULT '',
	`content_url` VARCHAR(2048) NULL DEFAULT '',
	`params` TEXT,

	`enabled` tinyint(1) NOT NULL DEFAULT '1',
	`ordering` bigint(20) unsigned NOT NULL,
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`created_by` int(11) NOT NULL DEFAULT 0,
	`modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`modified_by` int(11) NOT NULL DEFAULT 0,
	`locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`locked_by` int(11) NOT NULL DEFAULT 0,
	`notify1` int(10) unsigned NOT NULL DEFAULT '30',
	`notify2` int(10) unsigned NOT NULL DEFAULT '15',
	`notifyafter` int(10) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY ( `akeebasubs_level_id` ),
  UNIQUE KEY `slug` (`slug`(100))
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_relations" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_relations` (
    `akeebasubs_relation_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
    `source_level_id` bigint(20) NOT NULL DEFAULT '0',
    `target_level_id` bigint(20) NOT NULL DEFAULT '0',
    `mode` enum('rules','fixed','flexi') NOT NULL DEFAULT 'flexi',
    `type` enum('percent','value') NOT NULL DEFAULT 'percent',
    `amount` float NOT NULL DEFAULT '0',
    `low_threshold` int(11) NOT NULL DEFAULT '0',
    `low_amount` float NOT NULL DEFAULT '0',
    `high_threshold` int(11) NOT NULL DEFAULT '0',
    `high_amount` float NOT NULL DEFAULT '0',
    `flex_amount` float NOT NULL DEFAULT '0',
    `flex_period` int(11) NOT NULL DEFAULT '0',
    `flex_uom` enum('d','w','m','y') NOT NULL DEFAULT 'd',
    `flex_timecalculation` enum('current','future') NOT NULL DEFAULT 'current',
    `time_rounding` enum('floor','ceil','round') NOT NULL DEFAULT 'round',
    `expiration` enum('replace','after','overlap') NOT NULL DEFAULT 'replace',
    `combine` tinyint(3) NOT NULL DEFAULT '0',
    `enabled` tinyint(3) NOT NULL DEFAULT '0',
    `ordering` bigint(20) unsigned NOT NULL,
    `created_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `created_by` int(11) NOT NULL DEFAULT '0',
    `modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `modified_by` int(11) NOT NULL DEFAULT '0',
    `locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `locked_by` int(11) NOT NULL DEFAULT '0',
    PRIMARY KEY (`akeebasubs_relation_id`),
    UNIQUE KEY `akeebasubs_relation_unique` (`source_level_id`,`target_level_id`),
    KEY `akeebasubs_relations_target` (`target_level_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_subscriptions` (
	`akeebasubs_subscription_id` bigint(20) unsigned NOT NULL auto_increment,
	`user_id` bigint(20) unsigned NOT NULL,
	`akeebasubs_level_id` bigint(20) unsigned NOT NULL,
	`publish_up` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`publish_down` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`notes` TEXT,
	`enabled` tinyint(1) NOT NULL DEFAULT '1',

	`processor` varchar(255) NOT NULL,
	`processor_key` varchar(255) NOT NULL,
	`state` ENUM('N','P','C','X') not null default 'X',
	`net_amount` FLOAT NOT NULL,
	`tax_amount` FLOAT NOT NULL,
	`gross_amount` FLOAT NOT NULL,
	`tax_percent` FLOAT DEFAULT NULL,
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`params` TEXT,
	`ip` VARCHAR(255),
	`ip_country` VARCHAR(255),
	`ua` VARCHAR(255),
	`mobile` TINYINT(1) NOT NULL DEFAULT '0',
	`receipt_url` VARCHAR(255) NULL,
    `update_url` VARCHAR(255) NULL,
    `cancel_url` VARCHAR(255) NULL,
    `payment_url` VARCHAR(255) NULL,

	`akeebasubs_coupon_id` BIGINT(20) NULL,
	`akeebasubs_upgrade_id` BIGINT(20) NULL,
	`akeebasubs_invoice_id` BIGINT(20) NULL,
	`prediscount_amount` FLOAT NULL,
	`discount_amount` FLOAT NOT NULL DEFAULT '0',

	`contact_flag` tinyint(1) NOT NULL DEFAULT '0',
	`first_contact` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`second_contact` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`after_contact` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	PRIMARY KEY ( `akeebasubs_subscription_id` )
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_upgrades" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_upgrades` (
	`akeebasubs_upgrade_id` bigint(20) unsigned NOT NULL auto_increment,
	`title` varchar(255) NOT NULL,
	`from_id` bigint(20) unsigned NOT NULL,
	`to_id` bigint(20) unsigned NOT NULL,
	`min_presence` int(5) unsigned NOT NULL,
	`max_presence` int(5) unsigned NOT NULL,
	`type` ENUM('value','percent', 'lastpercent') NOT NULL DEFAULT 'value',
	`value` FLOAT NOT NULL DEFAULT '0.0',
	`combine` tinyint(1) NOT NULL DEFAULT '0',
    `expired` tinyint(1) NOT NULL DEFAULT '0',
	`enabled` tinyint(1) NOT NULL DEFAULT '1',
	`ordering` bigint(20) unsigned NOT NULL,
	`created_on` datetime NOT NULL default '0000-00-00 00:00:00',
	`created_by` int(11) NOT NULL DEFAULT 0,
	`modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`modified_by` int(11) NOT NULL DEFAULT 0,
	`locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
	`locked_by` int(11) NOT NULL DEFAULT 0,
	`hits` BIGINT(20) unsigned NOT NULL default '0',
	PRIMARY KEY ( `akeebasubs_upgrade_id` )
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>

        <action table="#__akeebasubs_users" canfail="0">
            <condition type="missing" value="" />
            <query><![CDATA[
CREATE TABLE `#__akeebasubs_users` (
	`akeebasubs_user_id` bigint(20) unsigned NOT NULL auto_increment,
	`user_id` bigint(20) unsigned NOT NULL,
	`isbusiness` TINYINT(1) NOT NULL DEFAULT '0',
	`businessname` VARCHAR(255) NULL,
	`occupation` VARCHAR(255) NULL,
	`vatnumber` VARCHAR(255) NULL,
	`viesregistered` TINYINT(1) NOT NULL DEFAULT '0',
	`taxauthority` VARCHAR(255) NULL,
	`address1` VARCHAR(255) NULL,
	`address2` VARCHAR(255) NULL,
	`city` VARCHAR(255) NULL,
	`zip` VARCHAR(255) NULL,
	`country` CHAR(2) NOT NULL DEFAULT 'XX',
	`params` TEXT,
	`notes` TEXT,
    `needs_logout` TINYINT NOT NULL DEFAULT '0',
	PRIMARY KEY ( `akeebasubs_user_id` ),
	UNIQUE KEY `joomlauser` (`user_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
        </action>



        <!-- Obsolete columns -->
        <action table="#__akeebasubs_coupons" canfail="1">
            <condition type="missing" value="akeebasubs_apicoupon_id" operator="not" />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_coupons` DROP COLUMN `akeebasubs_apicoupon_id`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_invoices" canfail="1">
            <condition type="missing" value="akeebasubs_invoicetemplate_id" operator="not" />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_invoices` DROP COLUMN `akeebasubs_invoicetemplate_id`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_levels" canfail="1">
            <condition type="missing" value="akeebasubs_levelgroup_id" operator="not" />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` DROP COLUMN `akeebasubs_levelgroup_id`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_levels" canfail="1">
            <condition type="missing" value="payment_plugins" operator="not" />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` DROP COLUMN `payment_plugins`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_levels" canfail="1">
            <condition type="missing" value="signupfee" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` DROP COLUMN `signupfee`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="akeebasubs_affiliate_id" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `akeebasubs_affiliate_id`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="net_amount_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `net_amount_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="tax_amount_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `tax_amount_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="gross_amount_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `gross_amount_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="prediscount_amount_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `prediscount_amount_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="discount_amount_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `discount_amount_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="affiliate_comission" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `affiliate_comission`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="affiliate_comission_alt" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `affiliate_comission_alt`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="1">
            <condition type="missing" value="recurring_amount" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` DROP COLUMN `recurring_amount`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_users" canfail="1">
            <condition type="missing" value="state" operator="not"  />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_users` DROP COLUMN `state`;
            ]]></query>
        </action>



        <!-- Obsolete tables -->
        <action table="#__akeebasubs_apicoupons" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_apicoupons`
            ]]></query>
        </action>

        <action table="#__akeebasubs_affiliates" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_affiliates`
            ]]></query>
        </action>

        <action table="#__akeebasubs_affpayments" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_affpayments`
            ]]></query>
        </action>

        <action table="#__akeebasubs_configurations" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_configurations`
            ]]></query>
        </action>

        <action table="#__akeebasubs_countrycurrencies" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_countrycurrencies`;
				]]></query>
        </action>

        <action table="#__akeebasubs_creditnotetemplates" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_creditnotetemplates`
            ]]></query>
        </action>

        <action table="#__akeebasubs_customfields" canfail="1">
            <condition type="missing" operator="not" value="" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_customfields`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_forexrates" canfail="0">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_forexrates`
					]]></query>
        </action>

        <action table="#__akeebasubs_invoicetemplates" canfail="1">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_invoicetemplates`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_levelgroups" canfail="1">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_levelgroups`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_states" canfail="1">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS `#__akeebasubs_states`;
            ]]></query>
        </action>

        <action table="#__akeebasubs_taxrules" canfail="1">
            <condition type="missing" value="" operator="not" />
            <query><![CDATA[
DROP TABLE IF EXISTS`#__akeebasubs_taxrules`
            ]]></query>
        </action>



        <!-- New columns -->
        <action table="#__akeebasubs_levels" canfail="0">
            <condition type="missing" value="paddle_product_id"   />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` ADD COLUMN
`paddle_product_id` varchar(100) NULL
AFTER `price`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` ADD COLUMN
`paddle_secret` varchar(100) NULL
AFTER `paddle_product_id`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` ADD COLUMN
`upsell` ENUM('never', 'always', 'renewal') DEFAULT 'never'
AFTER `paddle_secret`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` ADD COLUMN
`paddle_plan_id` varchar(100) NULL
AFTER `upsell`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_levels` ADD COLUMN
`paddle_plan_secret` varchar(100) NULL
AFTER `paddle_plan_id`
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="0">
            <condition type="missing" value="receipt_url"   />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` ADD COLUMN
`receipt_url` VARCHAR(255) NULL
AFTER `mobile`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` ADD COLUMN
`update_url` VARCHAR(255) NULL
AFTER `receipt_url`
            ]]></query>
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` ADD COLUMN
`cancel_url` VARCHAR(255) NULL
AFTER `update_url`
            ]]></query>
        </action>

        <action table="#__akeebasubs_subscriptions" canfail="0">
            <condition type="missing" value="payment_url"   />
            <query><![CDATA[
ALTER TABLE `#__akeebasubs_subscriptions` ADD COLUMN
`payment_url` VARCHAR(255) NULL
AFTER `cancel_url`
            ]]></query>
        </action>
    </sql>
</schema>